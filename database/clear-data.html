<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clear Firebase Data - Katalog Lelang</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-red-50 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full">
        <div class="text-center mb-6">
            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fa-solid fa-trash text-red-600 text-2xl"></i>
            </div>
            <h1 class="text-2xl font-bold text-gray-900 mb-2">Clear All Data</h1>
            <p class="text-gray-600">Hapus semua data dari Firebase</p>
        </div>

        <div class="space-y-4">
            <button id="clearBtn" onclick="clearAllData()"
                    class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors">
                <i class="fa-solid fa-trash-alt mr-2"></i>
                Hapus Semua Data
            </button>

            <button onclick="checkData()"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors">
                <i class="fa-solid fa-database mr-2"></i>
                Cek Jumlah Data
            </button>

            <div class="text-center">
                <a href="../index.html" class="text-indigo-600 hover:text-indigo-800 font-medium">
                    <i class="fa-solid fa-arrow-left mr-2"></i>Kembali ke Beranda
                </a>
            </div>
        </div>

        <div id="result" class="mt-6 p-4 rounded-lg hidden">
            <div id="resultMessage"></div>
        </div>
    </div>

    <!-- Firebase Config -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBLvY4uhXf81G0lFR0LmpKmZCjajubRpRs",
            authDomain: "katalog-lelang-aset.firebaseapp.com",
            databaseURL: "https://katalog-lelang-aset-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "katalog-lelang-aset",
            storageBucket: "katalog-lelang-aset.firebasestorage.app",
            messagingSenderId: "139807373486",
            appId: "1:139807373486:web:593657b916e56a6db3d53f"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const productsRef = database.ref('products');
        const settingsRef = database.ref('settings');

        // Initialize productDB
        const script = document.createElement('script');
        script.src = 'firebase-config.js';
        script.onload = () => {
            console.log('Firebase config loaded');
        };
        document.head.appendChild(script);

        async function clearAllData() {
            const btn = document.getElementById('clearBtn');
            const result = document.getElementById('result');
            const message = document.getElementById('resultMessage');

            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i>Menghapus data...';

            try {
                // Clear all products
                await productsRef.remove();

                // Clear settings
                await settingsRef.remove();

                // Force clear any remaining nodes
                await database.ref().remove();

                result.classList.remove('hidden', 'bg-red-100', 'bg-green-100');
                result.classList.add('bg-green-100');
                message.innerHTML = `
                    <div class="text-green-800 font-semibold">
                        <i class="fa-solid fa-check-circle mr-2"></i>
                        Semua data berhasil dihapus! Database kosong.
                    </div>
                `;

                // Check data count
                setTimeout(checkData, 1000);

            } catch (error) {
                console.error('Error clearing data:', error);
                result.classList.remove('hidden', 'bg-green-100');
                result.classList.add('bg-red-100');
                message.innerHTML = `
                    <div class="text-red-800">
                        <i class="fa-solid fa-exclamation-triangle mr-2"></i>
                        Error: ${error.message}
                    </div>
                `;
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fa-solid fa-trash-alt mr-2"></i>Hapus Semua Data';
            }
        }

        async function checkData() {
            const result = document.getElementById('result');
            const message = document.getElementById('resultMessage');

            try {
                const snapshot = await productsRef.once('value');
                const data = snapshot.val();
                const count = data ? Object.keys(data).length : 0;

                result.classList.remove('hidden', 'bg-red-100', 'bg-green-100', 'bg-blue-100');

                if (count === 0) {
                    result.classList.add('bg-green-100');
                    message.innerHTML = `
                        <div class="text-green-800 font-semibold">
                            <i class="fa-solid fa-check-circle mr-2"></i>
                            Data kosong! (0 produk)
                        </div>
                    `;
                } else {
                    result.classList.add('bg-blue-100');
                    message.innerHTML = `
                        <div class="text-blue-800">
                            <i class="fa-solid fa-database mr-2"></i>
                            Terdapat ${count} produk di database
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error checking data:', error);
                result.classList.remove('hidden');
                result.classList.add('bg-red-100');
                message.innerHTML = `
                    <div class="text-red-800">
                        <i class="fa-solid fa-exclamation-triangle mr-2"></i>
                        Error: ${error.message}
                    </div>
                `;
            }
        }

        // Check data on load
        window.addEventListener('load', checkData);
    </script>
</body>
</html>
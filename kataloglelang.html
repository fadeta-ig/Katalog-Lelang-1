<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Katalog Lelang Aset IT</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Katalog lelang aset IT dengan harga kompetitif. Macbook, Lenovo Thinkpad, Lenovo Ideapad, Acer Aspire. WhatsApp: 081553821808">
    <meta name="keywords" content="lelang laptop, laptop bekas, katalog IT, aset perusahaan, macbook, lenovo, acer, thinkpad, ideapad">
    <meta name="author" content="Wijaya Inovasi">
    <meta name="robots" content="index, follow">

    <!-- Open Graph -->
    <meta property="og:title" content="Katalog Lelang Aset IT">
    <meta property="og:description" content="Portal Lelang Aset IT - Wijaya Inovasi Gemilang">
    <meta property="og:type" content="website">
    <meta property="og:url" content="">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”¨</text></svg>">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <!-- Theme Color -->
    <meta name="theme-color" content="#6366f1">
    
    <!-- Tailwind CSS (via CDN for standalone functionality) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <!-- Firebase Configuration -->
    <script src="database/firebase-config.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            900: '#1e3a8a',
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        body {
            background-color: #f8fafc;
            overflow-x: hidden;
            max-width: 100vw;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* Prevent horizontal overflow */
        html, body {
            overflow-x: hidden;
        }
        #product-grid {
            max-width: 100%;
            overflow: hidden;
        }
        /* Ensure modal doesn't cause overflow */
        #product-modal {
            overflow: hidden;
        }
    </style>
</head>
<body class="text-slate-800 antialiased">

    <!-- Navbar -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-3">
                    <div class="bg-brand-600 text-white p-2 rounded-lg">
                        <i class="fa-solid fa-gavel"></i>
                    </div>
                    <span class="font-bold text-xl tracking-tight text-slate-900">IT Auction<span class="text-brand-600">Portal</span></span>
                </div>
                <div class="hidden md:flex items-center gap-4 text-sm font-medium text-slate-500">
                    <span>Total Aset: <span id="total-assets" class="text-slate-900 font-bold">0</span></span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Header & Search -->
    <header class="bg-white shadow-sm pb-8 pt-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center max-w-2xl mx-auto mb-8">
                <h1 class="text-3xl font-bold text-slate-900 mb-2">Portal Lelang Aset IT - Wijaya Inovasi Gemilang</h1>
                <p class="text-slate-500">Katalog aset laptop eks-perusahaan. Tersedia produk yang dilelang dan dalam proses peremajaan.</p>
            </div>

            <!-- Filters -->
            <div class="flex flex-col gap-4">
                <!-- Category Tabs -->
                <div class="flex flex-wrap gap-2 justify-center md:justify-start pb-2 md:pb-0" id="category-filters">
                    <button onclick="filterCategory('all')" class="filter-btn active px-4 py-2 rounded-full text-sm font-medium bg-brand-600 text-white transition-colors whitespace-nowrap">Semua</button>
                    <button onclick="filterCategory('Macbook')" class="filter-btn px-4 py-2 rounded-full text-sm font-medium bg-slate-100 text-slate-600 hover:bg-slate-200 transition-colors whitespace-nowrap">Apple Macbook</button>
                    <button onclick="filterCategory('Thinkpad')" class="filter-btn px-4 py-2 rounded-full text-sm font-medium bg-slate-100 text-slate-600 hover:bg-slate-200 transition-colors whitespace-nowrap">Lenovo Thinkpad</button>
                    <button onclick="filterCategory('Ideapad')" class="filter-btn px-4 py-2 rounded-full text-sm font-medium bg-slate-100 text-slate-600 hover:bg-slate-200 transition-colors whitespace-nowrap">Lenovo Ideapad</button>
                    <button onclick="filterCategory('Acer')" class="filter-btn px-4 py-2 rounded-full text-sm font-medium bg-slate-100 text-slate-600 hover:bg-slate-200 transition-colors whitespace-nowrap">Acer Aspire</button>
                </div>

                <!-- Search -->
                <div class="relative w-full md:w-80 mx-auto md:mx-0">
                    <input type="text" id="searchInput" placeholder="Cari spesifikasi atau kondisi..." class="w-full pl-10 pr-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent text-sm">
                    <i class="fa-solid fa-search absolute left-3 top-2.5 text-slate-400"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Grid Container -->
        <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Cards will be injected here via JS -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden text-center py-20">
            <div class="inline-block p-4 rounded-full bg-slate-100 mb-4">
                <i class="fa-regular fa-folder-open text-4xl text-slate-400"></i>
            </div>
            <h3 class="text-lg font-medium text-slate-900">Tidak ada aset ditemukan</h3>
            <p class="text-slate-500">Coba ubah kata kunci atau filter pencarian Anda.</p>
        </div>
    </main>

    <!-- Detail Modal -->
    <div id="product-modal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <!-- Backdrop -->
        <div class="fixed inset-0 bg-slate-900/75 transition-opacity backdrop-blur-sm" onclick="closeModal()"></div>

        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl">
                    
                    <!-- Modal Header with Image -->
                    <div class="bg-slate-50 relative">
                        <button onclick="closeModal()" class="absolute top-4 right-4 bg-white/80 p-2 rounded-full hover:bg-white text-slate-500 hover:text-red-500 transition-colors z-10">
                            <i class="fa-solid fa-times text-lg w-5 h-5 flex items-center justify-center"></i>
                        </button>
                        <div class="h-48 bg-gradient-to-r from-slate-200 to-slate-100 flex items-center justify-center" id="modal-image-container">
                            <!-- Icon/Image injected via JS -->
                        </div>
                    </div>

                    <!-- Modal Body -->
                    <div class="px-6 py-6 sm:px-8">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <span id="modal-category" class="inline-flex items-center rounded-md bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700 ring-1 ring-inset ring-blue-700/10 mb-2">Category</span>
                                <h3 class="text-2xl font-bold leading-6 text-slate-900" id="modal-title">Product Name</h3>
                                <p class="text-sm text-slate-500 mt-1" id="modal-subtitle">Full specs line</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xs text-slate-500 uppercase tracking-wide font-semibold">Harga Lelang</p>
                                <p class="text-2xl font-bold text-brand-600" id="modal-price">Rp 0</p>
                            </div>
                        </div>

                        <!-- Condition Alert -->
                        <div id="modal-condition-box" class="rounded-lg p-4 mb-6 flex items-start gap-3">
                            <i id="modal-condition-icon" class="fa-solid mt-0.5"></i>
                            <div>
                                <h4 class="text-sm font-semibold" id="modal-condition-title">Kondisi</h4>
                                <p class="text-sm mt-1" id="modal-condition-desc">Details</p>
                            </div>
                        </div>

                        <!-- Details Grid -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-4 border-t border-slate-100 pt-6">
                            <div>
                                <h4 class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-3">Spesifikasi Detail</h4>
                                <ul class="space-y-3 text-sm text-slate-700">
                                    <li class="flex items-center gap-3">
                                        <i class="fa-solid fa-microchip w-5 text-slate-400 text-center"></i>
                                        <span id="modal-cpu">-</span>
                                    </li>
                                    <li class="flex items-center gap-3">
                                        <i class="fa-solid fa-memory w-5 text-slate-400 text-center"></i>
                                        <span id="modal-ram">-</span>
                                    </li>
                                    <li class="flex items-center gap-3">
                                        <i class="fa-solid fa-hard-drive w-5 text-slate-400 text-center"></i>
                                        <span id="modal-storage">-</span>
                                    </li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-3">Riwayat & Valuasi</h4>
                                <ul class="space-y-3 text-sm text-slate-600">
                                    <li class="flex justify-between">
                                        <span>User Terakhir:</span>
                                        <span class="font-medium text-slate-900" id="modal-user">-</span>
                                    </li>
                                    <li class="flex justify-between">
                                        <span>Harga Beli Awal:</span>
                                        <span class="font-medium text-slate-900 decoration-slate-400" id="modal-original-price">-</span>
                                    </li>
                                    <li class="flex justify-between">
                                        <span>Lokasi Unit:</span>
                                        <span class="font-medium text-slate-900" id="modal-pic">-</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Modal Footer -->
                    <div class="bg-slate-50 px-6 py-4 sm:flex sm:flex-row-reverse sm:px-8 gap-3">
                        <button type="button" class="inline-flex w-full justify-center rounded-lg bg-brand-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-brand-500 sm:w-auto items-center gap-2">
                            <i class="fa-brands fa-whatsapp"></i> Ajukan Penawaran
                        </button>
                        <button type="button" onclick="closeModal()" class="mt-3 inline-flex w-full justify-center rounded-lg bg-white px-3 py-2 text-sm font-semibold text-slate-900 shadow-sm ring-1 ring-inset ring-slate-300 hover:bg-slate-50 sm:mt-0 sm:w-auto">
                            Tutup
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Data & Logic -->
    <script>
        // Initialize database
        let allProducts = [];
        let lelangProducts = [];

        // Load products from Firebase
        async function loadProducts() {
            try {
                // Check if productDB is initialized (from firebase-config.js)
                if (typeof productDB !== 'undefined') {
                    allProducts = await productDB.getAllProducts();

                    // Filter products with status 'Lelang' or 'Peremajaan' for catalog
                    lelangProducts = allProducts.filter(p => p.status === 'Lelang' || p.status === 'Peremajaan');

                    renderProducts(lelangProducts);
                    setupEventListeners();

                    // Set up real-time listener for updates
                    productDB.onProductsChanged((updatedProducts) => {
                        allProducts = updatedProducts;
                        lelangProducts = allProducts.filter(p => p.status === 'Lelang' || p.status === 'Peremajaan');
                        applyFilters();
                    });
                } else {
                    console.error('Firebase productDB not initialized');
                    showEmptyState();
                }
            } catch (error) {
                console.error('Error loading products from Firebase:', error);
                showEmptyState();
            }
        }

        // Show empty state when no data available
        function showEmptyState() {
            allProducts = [];
            lelangProducts = [];
            renderProducts([]);
            setupEventListeners();
        }

        // 2. Helper Functions
        const formatRupiah = (number) => {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(number);
        }

        const getCategory = (item) => {
            if (item.model.toLowerCase().includes('macbook')) return 'Macbook';
            if (item.model.toLowerCase().includes('thinkpad')) return 'Thinkpad';
            if (item.model.toLowerCase().includes('ideapad')) return 'Ideapad';
            if (item.model.toLowerCase().includes('acer')) return 'Acer';
            return 'Laptop';
        }

        const getStatusColor = (condition) => {
            const c = condition.toLowerCase();
            if (c === 'normal') return 'bg-emerald-100 text-emerald-700 border-emerald-200';
            if (c.includes('install ulang') || c.includes('lecet')) return 'bg-yellow-50 text-yellow-700 border-yellow-200';
            return 'bg-red-50 text-red-700 border-red-200';
        }
        
        const getStatusIcon = (condition) => {
            const c = condition.toLowerCase();
            if (c === 'normal') return 'fa-check-circle';
            if (c.includes('install ulang') || c.includes('lecet')) return 'fa-triangle-exclamation';
            return 'fa-circle-xmark';
        }

        const getImageIcon = (model) => {
            const m = model.toLowerCase();
            if (m.includes('macbook')) return '<i class="fa-brands fa-apple text-6xl text-slate-700"></i>';
            if (m.includes('thinkpad')) return '<span class="text-4xl font-bold font-mono text-slate-800">Think<span class="text-red-600">Pad</span></span>';
            if (m.includes('ideapad')) return '<span class="text-4xl font-bold font-sans text-slate-600 italic">Lenovo</span>';
            if (m.includes('acer')) return '<span class="text-4xl font-bold font-sans text-emerald-600 tracking-tighter">acer</span>';
            return '<i class="fa-solid fa-laptop text-6xl text-slate-400"></i>';
        }

        const parseSpecs = (specString) => {
            const parts = specString.split('|').map(s => s.trim());
            return {
                cpu: parts[0] || '-',
                ram: parts.find(s => s.toLowerCase().includes('ram')) || '-',
                storage: parts.find(s => s.toLowerCase().includes('ssd') || s.toLowerCase().includes('hdd')) || '-'
            };
        }

        // 3. Render Logic
        const grid = document.getElementById('product-grid');
        const totalAssetsEl = document.getElementById('total-assets');
        
        function renderProducts(data) {
            grid.innerHTML = '';
            totalAssetsEl.innerText = data.length;

            if(data.length === 0) {
                document.getElementById('empty-state').classList.remove('hidden');
                return;
            } else {
                document.getElementById('empty-state').classList.add('hidden');
            }

            data.forEach(item => {
                const category = getCategory(item);
                const conditionClass = getStatusColor(item.condition);
                const specs = parseSpecs(item.spec);

                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl border border-slate-200 overflow-hidden card-hover transition-all duration-300 flex flex-col h-full';

                // Check if product has images
                let imageHtml = '';
                if (item.images && item.images.length > 0) {
                    imageHtml = `<img src="${item.images[0].url}" alt="${item.model}" class="h-40 w-full object-cover">`;
                } else {
                    imageHtml = getImageIcon(item.model);
                }

                // Get status badge style
                const getStatusBadge = (status) => {
                    if (status === 'Lelang') {
                        return '<span class="inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-700/10">Lelang</span>';
                    } else if (status === 'Peremajaan') {
                        return '<span class="inline-flex items-center rounded-md bg-yellow-50 px-2 py-1 text-xs font-medium text-yellow-700 ring-1 ring-inset ring-yellow-700/10">Peremajaan</span>';
                    }
                    return '<span class="inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-700 ring-1 ring-inset ring-gray-700/10">' + status + '</span>';
                };

                card.innerHTML = `
                    <div class="h-40 bg-slate-50 flex items-center justify-center border-b border-slate-100 relative group cursor-pointer" onclick="openModal('${item.firebaseId || item.id}')">
                        ${imageHtml}
                        ${item.status === 'Peremajaan' ? '<div class="absolute top-2 right-2 bg-yellow-500 text-white px-2 py-1 rounded-full text-xs font-semibold">Peremajaan</div>' : ''}
                        <div class="absolute inset-0 bg-black/5 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                            <span class="bg-white/90 px-3 py-1 rounded-full text-xs font-semibold shadow-sm">Lihat Detail</span>
                        </div>
                    </div>

                    <div class="p-5 flex-1 flex flex-col">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">${category}</span>
                            <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium border ${conditionClass}">
                                ${item.condition === 'Normal' ? 'Normal' : 'Ada Catatan'}
                            </span>
                        </div>

                        <h3 class="font-bold text-slate-900 text-lg mb-1 leading-tight line-clamp-2" title="${item.model}">${item.model}</h3>

                        <!-- Mini Specs -->
                        <div class="flex gap-2 mb-4 mt-2 text-xs text-slate-500">
                            <div class="flex items-center gap-1 bg-slate-50 px-2 py-1 rounded border border-slate-100">
                                <i class="fa-solid fa-microchip"></i> <span>${specs.cpu.split(' ').slice(0,3).join(' ')}</span>
                            </div>
                            <div class="flex items-center gap-1 bg-slate-50 px-2 py-1 rounded border border-slate-100">
                                <i class="fa-solid fa-memory"></i> <span>${specs.ram.replace('RAM ', '')}</span>
                            </div>
                        </div>

                        <div class="mt-auto pt-4 border-t border-slate-100 flex items-end justify-between">
                            <div>
                                <p class="text-xs text-slate-400 mb-0.5">${item.status === 'Lelang' ? 'Harga Lelang' : 'Estimasi Harga'}</p>
                                <p class="text-lg font-bold ${item.status === 'Lelang' ? 'text-brand-600' : 'text-yellow-600'}">${formatRupiah(item.priceAuction)}</p>
                            </div>
                            <button onclick="openModal('${item.firebaseId || item.id}')" class="rounded-lg ${item.status === 'Lelang' ? 'bg-slate-900 hover:bg-slate-700' : 'bg-yellow-600 hover:bg-yellow-700'} px-3 py-2 text-xs font-semibold text-white shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2">
                                ${item.status === 'Lelang' ? 'Tawar' : 'Detail'}
                            </button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // 4. Filtering Logic
        let currentFilter = 'all';
        let currentSearch = '';

        function filterCategory(category) {
            currentFilter = category;
            
            // UI Button Active State
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if(btn.innerText.toLowerCase().includes(category.toLowerCase()) || (category === 'all' && btn.innerText === 'Semua')) {
                    btn.classList.remove('bg-slate-100', 'text-slate-600', 'hover:bg-slate-200');
                    btn.classList.add('bg-brand-600', 'text-white');
                } else {
                    btn.classList.add('bg-slate-100', 'text-slate-600', 'hover:bg-slate-200');
                    btn.classList.remove('bg-brand-600', 'text-white');
                }
            });

            applyFilters();
        }

        document.getElementById('searchInput').addEventListener('input', (e) => {
            currentSearch = e.target.value.toLowerCase();
            applyFilters();
        });

  
        // 5. Modal Logic
        function openModal(id) {
            console.log('Opening modal with ID:', id);
            const item = lelangProducts.find(i => i.firebaseId === id || i.id === id);
            if (!item) {
                console.error('Product not found with ID:', id);
                console.error('Available products:', lelangProducts.map(p => ({ firebaseId: p.firebaseId, id: p.id, model: p.model })));
                return;
            }
            console.log('Found product:', item);

            const specs = parseSpecs(item.spec);
            const conditionClass = getStatusColor(item.condition);
            const conditionIcon = getStatusIcon(item.condition);

            // Populate Modal
            document.getElementById('modal-title').innerText = item.model;
            document.getElementById('modal-category').innerText = getCategory(item);
            document.getElementById('modal-subtitle').innerText = item.spec.split('|')[0]; // Just CPU
            document.getElementById('modal-price').innerText = formatRupiah(item.priceAuction);

            // Update category and status in modal header
            const modalCategorySpan = document.querySelector('#product-modal .mb-2');
            modalCategorySpan.className = `inline-flex items-center rounded-md ${item.status === 'Lelang' ? 'bg-blue-50 text-blue-700 ring-1 ring-inset ring-blue-700/10' : 'bg-yellow-50 text-yellow-700 ring-1 ring-inset ring-yellow-700/10'} px-2 py-1 text-xs font-medium mb-2`;
            modalCategorySpan.innerHTML = `${getCategory(item)} - ${item.status}`;

            // Update price label
            document.querySelector('#product-modal .text-right .text-xs').textContent = item.status === 'Lelang' ? 'Harga Lelang' : 'Estimasi Harga';
            document.getElementById('modal-price').className = `text-2xl font-bold ${item.status === 'Lelang' ? 'text-brand-600' : 'text-yellow-600'}`;

            // Image - check if product has images
            if (item.images && item.images.length > 0) {
                document.getElementById('modal-image-container').innerHTML = `
                    <img src="${item.images[0].url}" alt="${item.model}" class="h-48 w-full object-cover">
                `;
            } else {
                document.getElementById('modal-image-container').innerHTML = getImageIcon(item.model);
            }

            // Specs
            document.getElementById('modal-cpu').innerText = specs.cpu;
            document.getElementById('modal-ram').innerText = specs.ram;
            document.getElementById('modal-storage').innerText = specs.storage;

            // Condition Alert Box
            const box = document.getElementById('modal-condition-box');
            const boxTitle = document.getElementById('modal-condition-title');
            const boxIcon = document.getElementById('modal-condition-icon');

            box.className = `rounded-lg p-4 mb-6 flex items-start gap-3 border ${conditionClass}`;
            boxIcon.className = `fa-solid ${conditionIcon} mt-0.5 text-lg`;
            boxTitle.innerText = item.condition === 'Normal' ? 'Kondisi Prima' : 'Perhatian: Catatan Kondisi';
            document.getElementById('modal-condition-desc').innerText = item.condition;

            // Details
            document.getElementById('modal-user').innerText = item.user;
            document.getElementById('modal-pic').innerText = item.pic;
            document.getElementById('modal-original-price').innerText = formatRupiah(item.priceOriginal);

            // WhatsApp button
            const whatsappBtn = document.querySelector('#product-modal button[type="button"]:first-of-type');
            whatsappBtn.onclick = () => sendWhatsApp(item);
            // Update button text based on status
            whatsappBtn.innerHTML = item.status === 'Lelang'
                ? '<i class="fa-brands fa-whatsapp"></i> Ajukan Penawaran'
                : '<i class="fa-brands fa-whatsapp"></i> Tanyakan Info';

            document.getElementById('product-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        }

        function closeModal() {
            document.getElementById('product-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // WhatsApp integration
        function sendWhatsApp(product) {
            console.log('Sending WhatsApp for product:', product);
            const phoneNumber = '6281553821808'; // 081553821808 with country code
            const message = encodeURIComponent(
                `Halo, saya tertarik dengan produk:\n\n` +
                `*${product.model}*\n` +
                `Tipe: ${getCategory(product)}\n` +
                `Status: ${product.status}\n` +
                `Spesifikasi: ${product.spec}\n` +
                `Kondisi: ${product.condition}\n` +
                `${product.status === 'Lelang' ? 'Harga Lelang' : 'Estimasi Harga'}: ${formatRupiah(product.priceAuction)}\n\n` +
                `${product.status === 'Lelang' ? 'Apakah masih tersedia untuk dilelang?' : 'Apakah produk ini sudah tersedia?' }`
            );

            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${message}`;
            window.open(whatsappUrl, '_blank');
        }

        // Setup event listeners
        function setupEventListeners() {
            // Search input is already set up below, no need to add again
        }

        // Apply filters with loaded data
        function applyFilters() {
            const filtered = lelangProducts.filter(item => {
                const category = getCategory(item);
                const matchesCategory = currentFilter === 'all' || category.toLowerCase() === currentFilter.toLowerCase();
                const matchesSearch = item.model.toLowerCase().includes(currentSearch) ||
                                     item.spec.toLowerCase().includes(currentSearch) ||
                                     item.condition.toLowerCase().includes(currentSearch);
                return matchesCategory && matchesSearch;
            });

            renderProducts(filtered);
        }

        // Close modal on Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === "Escape") {
                closeModal();
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', loadProducts);

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);

                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Show notification for update
                                    showUpdateNotification();
                                }
                            });
                        });
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Show update notification
        function showUpdateNotification() {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-blue-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-3';
            notification.innerHTML = `
                <i class="fa-solid fa-download"></i>
                <span>Update tersedia! Klik untuk memperbarui.</span>
                <button onclick="location.reload()" class="ml-3 bg-blue-700 hover:bg-blue-800 px-3 py-1 rounded transition">
                    Refresh
                </button>
            `;
            document.body.appendChild(notification);
        }

        // Add keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.altKey && e.key === 'a') {
                e.preventDefault();
                window.location.href = 'admin/login.html';
            }
            if (e.altKey && e.key === 'h') {
                e.preventDefault();
                window.location.href = '/index.html';
            }
        });

        // Add page visibility API to refresh when returning to tab
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                loadProducts();
            }
        });

    </script>
</body>
</html>